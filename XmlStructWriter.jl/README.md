# XmlStructWriter.jl

[![Dev Docs](https://img.shields.io/badge/docs-dev-blue.svg)](https://tom-lemmens.github.io/XmlStructTools.jl/XmlStructWriter.jl/dev/)

## Getting the required files

In order to get the required *.jl files follow the instructions of `XsdToStruct`.

## Creating an xml file from scratch

In this example we create an XML file called "example.xml" that follows the schema "example.xsd" which defines the "ExampleSchema" namespace.

Let's assume that "example.xsd" looks as follows:

```xml
<?xml version="1.0"?>
<schema xmlns="http://www.w3.org/2001/XMLSchema" xmlns:ExampleSchema="ExampleSchema" targetNamespace="ExampleSchema">

<element name="document" type="ExampleSchema:documentType"/>

<complexType name="ExampleComplexType">
    <annotation>
        <documentation>An example of a complex xsd type.</documentation>
    </annotation>
    <sequence>
        <element name="Element_double" type="double"/>
        <element name="Element_boolean" type="boolean"/>
        <element name="Element_integer" type="integer"/>
    </sequence>
</complexType>

<simpleType name="ExampleSimpleType">
    <annotation>
        <documentation>An example of a simple xsd type.</documentation>
    </annotation>
    <restriction base="string">
        <maxLength value="4"/>
    </restriction>
</simpleType>

<complexType name="documentType">
    <sequence>
        <element name="Example1" type="ExampleSchema:ExampleComplexType"/>
        <element name="Example2" type="ExampleSchema:ExampleSimpleType"/>
    </sequence>
</complexType>

</schema>
```

And we want to make the following file called "example.xml":

```xml
<?xml version="1.0" encoding="utf-8"?>

<ExampleSchema:document xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="ExampleSchema Example.xsd" xmlns:ExampleSchema="ExampleSchema">
    <Example1>
        <Element_double>100.22</Element_double>
        <Element_boolean>true</Element_boolean>
        <Element_integer>-778</Element_integer>
    </Example1>

    <TestElement2>AA99</TestElement2>
</ExampleSchema:document>
```

The procedure consists of three steps:

1. We load the struct definitions generated by `XsdToStruct`.
2. We construct an instance of the struct representing the xml file with the required data.
3. We write the struct instance to a file.

### Loading the struct definitions

If we put the *.jl files generated by `XsdToStruct` in the folder "Example" we can load the struct definitions as follows:

```julia
include(joinpath("Example", "Example.jl"))
using .ExampleSchema
```

### Creating the struct instance

Next we create struct instances with the data that we want to put into the xml.

```julia
Example1 = ExampleComplexType(
    Element_double=100.22,
    Element_boolean=true,
    Element_integer=-778
)

xml_attributes = Dict(
    "xmlns:xsi"=>"http://www.w3.org/2001/XMLSchema-instance",
    "xsi:schemaLocation"=>"ExampleSchema Example.xsd",
    "xmlns:ExampleSchema"=>"ExampleSchema",
    "__root_name"=>"document"
)

document = documentType(
    Example1=Example1,
    Example2="AA99",
    __xml_attributes=xml_attributes
)
```

### Writing the xml file

Finally we write the xml struct to a file:

```julia
using XmlStructWriter

write_xml(document, "example.xml")
```

## Editing an xml file

In this example we will edit the xml file from the previous example. We want to change the value of the "Example1/Element_double" to "-789.123".

The procedure is very similar to before:

1. We load the struct definitions generated by `XsdToStruct.jl`.
2. We load the xml file with `XmlStructLoader.jl`
3. We construct an new instance of the struct representing the xml file with the appropriate data copied from the loaded xml file and new data inserted as required.
4. We write the struct instance to a file.

This procedure can be simplified by using `Accessors.jl` but this is currently not yet completly supported by the structs generated by `XsdToStruct.jl`.

### Loading the struct definitions

If we put the *.jl files generated by `XsdToStruct.jl` in the folder "Example" we can load the struct definitions as follows:

```julia
include(joinpath("Example", "Example.jl"))
using .ExampleSchema
```

### Loading the xml file

We can load the existing xml file with `XmlStructLoader`:

```julia
using XmlStructLoader

xml = load("example.xml", ExampleSchema)
```

### Editing the data

Next we create a new struct instance with the edited data:

```julia
Example1 = ExampleComplexType(
    Element_double=-789.123,
    Element_boolean=xml.Example1.Element_boolean,
    Element_integer=xml.Example1.Element_integer
)

document = documentType(
    Example1=Example1,
    Example2=xml.Example2,
    __xml_attributes=xml.__xml_attributes
)
```

### Writing the xml file

Finally we write the new xml struct to a file:

```julia
using XmlStructWriter

write_xml(document, "example_2.xml")
```
